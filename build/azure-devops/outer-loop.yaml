trigger:
  branches:
    include:
    - master
    exclude:
    - develop
    - features/*
  paths:
    exclude:
    - .github/*
    - .gitignore
    - LICENSE

jobs:
- job: Linux
  displayName: Linux

  pool:
    vmImage: ubuntu-16.04

  steps:
  - bash: ./build/cake/build.sh
      \-s build/cake/build.cake
      \--target=Publish-NuGet-Package
      \--coveralls="$(Coveralls.Token)"
      \--coveralls_path="$(System.DefaultWorkingDirectory)/artifacts/coverage.opencover.xml"
      \--nuget_apiKey="$(NuGet.Test)"
    displayName: Publish NuGet Package

  - task: PublishTestResults@2
    displayName: Publish Unit Tests Results To Azure DevOps
    inputs:
       testResultsFormat: VSTest
       testResultsFiles: '**/*.trx'
       mergeTestResults: true
       testRunTitle: Linux

  - task: PublishCodeCoverageResults@1
    displayName: Publish Code Coverage Results To Azure DevOps
    inputs:
      codecoverageTool: cobertura
      summaryFileLocation: $(System.DefaultWorkingDirectory)/**/artifacts/coverage.cobertura.xml
      reportDirectory: $(System.DefaultWorkingDirectory)/**/artifacts