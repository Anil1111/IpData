trigger:
  branches:
    include:
    - master
    exclude:
    - develop
    - features/*
  paths:
    exclude:
    - .github/*
    - .gitignore
    - LICENSE

jobs:
- job: Linux
  displayName: Linux

  pool:
    vmImage: ubuntu-16.04

  steps:
  - powershell: ./build/cake/build.ps1 -Script build/cake/build.cake -Target Run-Unit-Tests
    displayName: Run Cake Target 'Run-Unit-Tests'

  - task: PublishTestResults@2
    displayName: Publish Unit Tests Results To Azure DevOps
    inputs:
       testResultsFormat: VSTest
       testResultsFiles: '**/*.trx'
       mergeTestResults: true
       testRunTitle: Linux

  - task: PublishCodeCoverageResults@1
    displayName: Publish Code Coverage Results To Azure DevOps
    inputs:
      codecoverageTool: cobertura
      summaryFileLocation: $(System.DefaultWorkingDirectory)/**/artifacts/coverage.cobertura.xml
      reportDirectory: $(System.DefaultWorkingDirectory)/**/artifacts

  - powershell:
      -| ./build/cake/build.ps1
      -Script build/cake/build.cake
      -Target Publish-Coverage
      -ScriptArgs '-Coveralls="$(Coveralls.Token)"',
                  '-CoverallsPath="$(System.DefaultWorkingDirectory)/artifacts/coverage.opencover.xml"'
    displayName: Publish Code Coverage Results To Coveralls

  - powershell: ./build/cake/build.ps1 -Script build/cake/build.cake -Target Publish-NuGet-Package -ScriptArgs ''
    displayName: Publish NuGet Package